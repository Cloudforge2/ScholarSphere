<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="'Paper Summary - ' + ${title}">Paper Summary - ScholarSphere</title>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background-color: #f8fafc;
      color: #1e293b;
    }

    header {
      background: linear-gradient(90deg, #0d4f4c, #2563eb);
      color: white;
      padding: 15px 40px;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .main-container {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 25px;
      padding: 30px 40px;
      height: calc(100vh - 80px);
      box-sizing: border-box;
    }

    .summary-panel {
      background: white;
      border-radius: 18px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      padding: 25px 30px;
      overflow-y: auto;
    }

    .summary-panel h2 {
      margin-bottom: 5px;
      font-size: 22px;
    }

    .paper-id {
      margin-bottom: 15px;
      font-size: 14px;
      color: #475569;
    }

    .summary-panel h3 {
      margin-top: 20px;
      font-size: 18px;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 5px;
      color: #0d4f4c;
    }

    /* HEADINGS red */
    .section-title {
      background: #fce7e7;
      border-left: 4px solid #dc2626;
      margin-top: 20px;
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 700;
      color: #b91c1c;
    }

    /* BODY paragraphs */
    .summary-panel p {
      margin-bottom: 12px;
      color: #1e293b;
      line-height: 1.6;
      font-size: 15px;
    }

    .coauthor-section {
      margin-top: 20px;
    }

    .coauthor-item {
      background: #eef2ff;
      color: #312e81;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 8px;
      border-left: 4px solid #4f46e5;
      font-weight: 500;
      transition: transform 0.2s ease;
    }

    .coauthor-item:hover {
      transform: translateX(5px);
      background: #e0e7ff;
    }

    .graph-panel {
      background:#fff;
      border-radius: 18px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    #graph-container {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

<header>
    <div>üìÑ Paper Summary & Author Graph</div>

    <div style="display:flex; gap:15px;">
        <button onclick="window.location.href='/main'" style="background:white; color:#2563eb; border:none; padding:8px 15px; border-radius:8px; font-weight:600;">New Search</button>
        <button onclick="window.location.href='/change-password'" style="background:white; color:#2563eb; border:none; padding:8px 15px; border-radius:8px; font-weight:600;">Change Password</button>
        <button onclick="window.location.href='/logout-confirm'" style="background:#ef4444; color:white; border:none; padding:8px 15px; border-radius:8px; font-weight:600;">Logout</button>
    </div>
</header>

<div class="main-container">

    <!-- LEFT PANEL -->
    <div class="summary-panel">
        <h2 th:text="${title}">Paper Title</h2>

<!-- ‚≠ê DOI Section -->
<p class="paper-id" th:if="${doi}">
    <strong>DOI:</strong>
    <a th:href="'https://doi.org/' + ${doi}"
       th:text="${doi}"
       target="_blank"
       style="color:#2563eb; font-weight:600; text-decoration:none;">
    </a>
</p>

<p class="paper-id" th:if="${doi == null}">
    <strong>DOI:</strong> Not available
</p>

<!-- Paper ID -->
<p class="paper-id">
    <strong>Paper ID:</strong> 
    <span th:text="${paperId}">ID</span>
</p>

        <h3>üßæ Summary</h3>

        <!-- RENDER SUMMARY SECTIONS -->
        <div class="summary-content">
            <div th:each="sec : ${sections}">
                <h4 th:if="${sec.heading != ''}" class="section-title" th:text="${sec.heading}"></h4>
                <p th:text="${sec.body}"></p>
            </div>
        </div>

        <div th:if="${paper != null and paper.authors != null and !#lists.isEmpty(paper.authors)}" class="coauthor-section">
            <h3>üë©‚Äçüî¨ Coauthors</h3>
            <div th:each="author : ${paper.authors}" class="coauthor-item" th:text="${author.displayName}"></div>
        </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="graph-panel">

        <div th:if="${error}" style="background:#fee2e2; color:#b91c1c; padding:14px; margin:25px; border-radius:12px; text-align:center;">
            <span th:text="${error}"></span>
        </div>

        <div id="graph-container" th:if="${error == null}"></div>
    </div>

</div>


<!-- VIS NETWORK SCRIPT (unchanged) -->
<script th:inline="javascript">
/*<![CDATA[*/
document.addEventListener("DOMContentLoaded", function () {

    let raw = /*[[${graphJson}]]*/ '{"nodes":[],"edges":[]}';

    if (typeof raw === "string") raw = JSON.parse(raw);

    const visNodes = raw.nodes.map(n => {
        const d = n.data;
        const full = d.label ?? "";
        const short = full.split(" ").slice(0, 3).join(" ") + (full.split(" ").length > 3 ? "‚Ä¶" : "");

        if (d.type === "paper") {
            return {
                id: d.id,
                label: short,
                title: full,
                shape: "box",
                color: { background: "#2563eb", border: "#1e3a8a" },
                font: { color: "white", size: 16, face: "Inter", bold: true },
                type: d.type
            };
        }
        return {
            id: d.id,
            label: full,
            shape: "circle",
            color: { background: "#f1f5f9", border: "#475569" },
            font: { color: "#111827", size: 14, face: "Inter" },
            type: d.type
        };
    });

    const visEdges = raw.edges.map(e => ({
        id: e.data.id,
        from: e.data.source,
        to: e.data.target,
        color: { color: "#94a3b8" },
        width: 2,
        smooth: { type: "dynamic" }
    }));

    const container = document.getElementById("graph-container");
    if (!container) return;

    const data = { nodes: new vis.DataSet(visNodes), edges: new vis.DataSet(visEdges) };

    const options = {
        layout: { improvedLayout: true },
        physics: {
            solver: "forceAtlas2Based",
            forceAtlas2Based: { gravitationalConstant: -60, springLength: 200, springConstant: 0.05 },
            stabilization: { iterations: 250 }
        }
    };

    const network = new vis.Network(container, data, options);

    network.once("stabilizationIterationsDone", () => network.fit({ animation: true }));
});
/*]]>*/
</script>

</body>
</html>
