
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="'Paper Summary - ' + ${title}">Paper Summary - ScholarSphere</title>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f4f6;
    }
    header {
      background: linear-gradient(90deg, #0d4f4c, #2563eb);
      color: white;
      padding: 20px 40px;
      font-size: 24px;
      font-weight: 600;
      text-align: center;
    }
    .main-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: stretch;
      padding: 25px;
      gap: 25px;
    }
    .summary-panel {
      flex: 1;
      min-width: 350px;
      max-width: 480px;
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    .graph-panel {
      flex: 1.5;
      min-width: 450px;
      height: 600px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    h2 {
      color: #1f2937;
      margin-bottom: 15px;
    }
    p {
      font-size: 16px;
      color: #374151;
      line-height: 1.6;
    }
    .coauthor-item {
      background: #e0f2fe;
      padding: 10px 15px;
      margin-bottom: 8px;
      border-radius: 8px;
      border-left: 4px solid #2563eb;
      font-weight: 500;
      color: #1e3a8a;
    }
    #graph-container {
      width: 100%;
      height: 100%;
      border-radius: 15px;
    }
  </style>
</head>

<body>
<header>üìÑ Paper Summary & Author Graph</header>

<div class="main-container">
  <!-- Left: Summary panel -->
  <div class="summary-panel">
    <h2 th:text="${title}">Paper Title</h2>
    <p><strong>Summary:</strong> <span th:text="${summary}">Summary goes here.</span></p>

    <div th:if="${paper != null and paper.authors != null}">
      <h3>üë©‚Äçüî¨ Coauthors</h3>
      <div th:each="author : ${paper.authors}" class="coauthor-item"
           th:text="${author.displayName}">Coauthor Name</div>
    </div>

    <div th:if="${paper == null or paper.authors == null or #lists.isEmpty(paper.authors)}">
      <p><em>No coauthors found for this paper.</em></p>
    </div>
  </div>

  <!-- Right: Graph panel -->
  <div class="graph-panel">
    <div id="graph-container"></div>
  </div>
</div>

<script th:inline="javascript">
/*<![CDATA[*/
document.addEventListener("DOMContentLoaded", function () {
  let graphData = /*[[${graphJson}]]*/ '{"nodes":[],"edges":[]}';
  if (typeof graphData === "string") graphData = JSON.parse(graphData);

  const nodes = graphData.nodes.map(n => {
    const fullLabel = n.data.label;
    const shortLabel = fullLabel.split(" ").slice(0, 3).join(" ") +
      (fullLabel.split(" ").length > 3 ? "‚Ä¶" : "");

    if (n.data.type === 'paper') {
      return {
        id: n.data.id,
        label: shortLabel,
        title: fullLabel,
        shape: 'box',
        color: { background: '#2563eb', border: '#1e3a8a' },
        font: { color: 'white', size: 16, face: 'Roboto', bold: true },
        widthConstraint: { maximum: 200 },
        size: 50,
        margin: 10,
        type: n.data.type
      };
    } else {
      return {
        id: n.data.id,
        label: n.data.label,
        shape: 'circle',
        color: { background: '#f9fafb', border: '#1f2937' },
        font: { color: '#111827', size: 14, face: 'Roboto' },
        size: 35,
        type: n.data.type
      };
    }
  });

  const edges = graphData.edges.map(e => ({
    from: e.data.source,
    to: e.data.target,
    color: { color: '#9ca3af' },
    width: 2,
    smooth: { type: 'dynamic' }
  }));

  const container = document.getElementById('graph-container');
  const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };

  const options = {
    layout: { improvedLayout: true },
    physics: {
      solver: 'forceAtlas2Based',
      forceAtlas2Based: {
        gravitationalConstant: -60,
        springLength: 200,
        springConstant: 0.05
      },
      stabilization: { iterations: 250 },
    },
    nodes: {
      shadow: true,
      borderWidth: 2
    },
    edges: { shadow: false },
    interaction: {
      hover: true,
      tooltipDelay: 120,
      zoomView: true,
      dragNodes: true
    }
  };

  const network = new vis.Network(container, data, options);

  // Auto-center
  network.once("stabilizationIterationsDone", () => {
    network.fit({ animation: true });
  });

  // Node click: navigate to coauthor page
  network.on("click", params => {
    if (params.nodes.length > 0) {
      const nodeId = params.nodes[0];
      const node = data.nodes.get(nodeId);
      if (node.type === "author") {
        window.location.href = '/professor-summary?name=' + encodeURIComponent(node.label);
      }
    }
  });
});
/*]]>*/
</script>
</body>
</html>